# 新規プロジェクト作成手順

## 📋 概要

この手順書では、sera-inc/engineering-handbookの全ルールに準拠した新規プロジェクトを作成する方法を説明します。

## ⚠️ 重要：GitHubテンプレートは使用しない

GitHubで新規リポジトリを作成する際、**「Start with a template」は使用しないでください**。

理由：
- ✅ 初期化スクリプトがengineering-handbookの全ルールに準拠した構造を自動生成
- ✅ ラベル、Wiki、ワークフローなどが自動的に設定される
- ✅ 全プロジェクトで同じ標準が適用され、一貫性が保たれる
- ✅ 常に最新のベストプラクティスが反映される

## 🚀 推奨手順

### 前提条件

1. **GitHub Personal Access Token の準備**
   - https://github.com/settings/tokens にアクセス
   - "Generate new token (classic)" をクリック
   - 必要なスコープを選択：
     - ✅ `repo` (リポジトリへのフルアクセス)
     - ✅ `project` (プロジェクトへのフルアクセス)
     - ✅ `admin:org` (組織レベルのプロジェクト設定用)
   - トークンを生成してコピー（後で見られません！）

2. **開発ツールのインストール**
   - Python プロジェクトの場合: [uv](https://github.com/astral-sh/uv)
     ```bash
     curl -LsSf https://astral.sh/uv/install.sh | sh
     ```
   - TypeScript プロジェクトの場合: [Node.js 20+](https://nodejs.org/) と [pnpm](https://pnpm.io/)
     ```bash
     npm install -g pnpm
     ```

### ステップ1: GitHubで空のリポジトリを作成

1. https://github.com/sera-inc にアクセス
2. 右上の "New repository" ボタンをクリック
3. 以下のように設定：

   | 項目 | 設定 |
   |------|------|
   | **Repository name** | プロジェクト名を入力（例: `my-new-project`） |
   | **Description** | （オプション）プロジェクトの説明 |
   | **Visibility** | Private または Public を選択 |
   | **❌ Add a README file** | **チェックしない** |
   | **❌ Add .gitignore** | **選択しない** |
   | **❌ Choose a license** | **選択しない** |

4. "Create repository" ボタンをクリック

**⚠️ 重要**: README、.gitignore、ライセンスは全て追加しないでください。これらは初期化スクリプトが自動生成します。

### ステップ2: ローカルで初期化スクリプトを実行

```bash
# sera-inc/.github リポジトリをクローン（初回のみ）
git clone https://github.com/sera-inc/.github.git
cd .github

# 初期化スクリプトを実行
./setup-new-project.sh
```

### ステップ3: 対話形式で情報を入力

スクリプトが以下の情報を順番に尋ねます：

1. **プロジェクトタイプ**:
   - `1` を入力: Python プロジェクト
   - `2` を入力: TypeScript プロジェクト

2. **プロジェクト名**:
   - 例: `my-new-project`

3. **GitHub オーナー/組織**:
   - `sera-inc` と入力

4. **GitHub リポジトリ名**:
   - ステップ1で作成したリポジトリ名を入力（例: `my-new-project`）

5. **GitHub Personal Access Token**:
   - 前提条件で生成したトークンを入力

### ステップ4: 設定内容を確認

スクリプトが設定内容のサマリーを表示します：

```
📋 Configuration Summary
========================
Project Directory: .
Project Type: python
Project Name: my-new-project
GitHub Owner: sera-inc
GitHub Repository: my-new-project

Proceed with initialization? (y/n):
```

内容を確認して `y` を入力します。

### ステップ5: 自動セットアップの完了を待つ

以下が自動的に実行されます（数分かかります）：

1. ✅ プロジェクト構造の作成（Clean Architecture 4層構造）
2. ✅ 開発環境のセットアップ（設定ファイル、依存関係）
3. ✅ Git フックの設定（pre-commit品質チェック）
4. ✅ CI/CD ワークフローの配置（5種類のワークフロー）
5. ✅ GitHub ラベルの作成（53個のラベル）
6. ✅ GitHub Wiki の初期化（9ページのドキュメント）
7. ✅ GitHub Projects の設定ガイド表示

### ステップ6: Git リポジトリを初期化してプッシュ

```bash
# 作成されたプロジェクトディレクトリに移動
cd ../my-new-project  # または指定したディレクトリ

# Git を初期化
git init
git add .
git commit -m "chore: initial project setup"

# リモートリポジトリに接続してプッシュ
git remote add origin git@github.com:sera-inc/my-new-project.git
git branch -M main
git push -u origin main
```

### ステップ7: GitHub Projects を手動設定

GitHub Projects は手動設定が必要です。詳細は [github-projects-setup.md](./github-projects-setup.md) を参照してください。

**概要**:
1. https://github.com/orgs/sera-inc/projects にアクセス
2. "New project" をクリック
3. プロジェクト名を入力、テンプレート "Team backlog" を選択
4. 9つのカスタムフィールドを作成（Status, Priority, Component, Sprint, Story Points, Must/Want, Figma Link, Security Status, Review Status）
5. 7つのビューを作成（Main Kanban, Sprint Board, Team Members, Priority View, Component View, Review Pipeline, Completed Tasks）
6. 3つの自動化ルールを設定（Issue自動追加、PR自動追加、マージ時ステータス更新）

### ステップ8: GitHub リポジトリの設定

#### ブランチ保護ルール

1. リポジトリの Settings → Branches にアクセス
2. `main` ブランチのルールを追加：
   - ✅ Require pull request reviews before merging（Required approvals: 1）
   - ✅ Require status checks to pass before merging（必須: `lint-and-test`, `security-scan`）
   - ✅ Require linear history
   - ✅ Do not allow bypassing the above settings

#### 環境の設定

Settings → Environments で3つの環境を作成：

- **Development**: 保護ルールなし
- **Staging**: Required reviewers 1人、Wait timer 0分
- **Production**: Required reviewers 2人（PM含む）、Wait timer 5分

#### シークレットの設定

Settings → Secrets and variables → Actions で必要に応じて追加：
- `CODECOV_TOKEN`: コードカバレッジレポート用
- `SLACK_WEBHOOK_URL`: デプロイ通知用
- `AWS_ROLE_ARN`, `AWS_REGION`: AWS使用時

### ステップ9: セットアップの検証

#### Python プロジェクトの場合

```bash
# 依存関係のインストール
uv sync

# 品質チェックの実行
uv run ruff format .      # コードフォーマット
uv run ruff check .       # リント
uv run pyright            # 型チェック
uv run pytest             # テスト実行

# Git フックのテスト
git add .
git commit -m "test: verify setup"
```

#### TypeScript プロジェクトの場合

```bash
# 依存関係のインストール
pnpm install

# 品質チェックの実行
pnpm format               # コードフォーマット
pnpm lint                 # リント
pnpm typecheck            # 型チェック
pnpm test                 # テスト実行

# Git フックのテスト
git add .
git commit -m "test: verify setup"
```

## ✅ セットアップ完了後の確認事項

以下が正しく設定されていることを確認してください：

- [ ] GitHubリポジトリにコードがプッシュされている
- [ ] GitHub Labelsが53個作成されている
- [ ] GitHub Wikiに9ページのドキュメントがある
- [ ] GitHub Projectsが設定されている
- [ ] ブランチ保護ルールが設定されている
- [ ] 環境（Development, Staging, Production）が設定されている
- [ ] CI/CDワークフローが `.github/workflows/` に配置されている
- [ ] ローカルで品質チェックが実行できる
- [ ] Git フックが動作する

## 📊 作成されるもの一覧

### プロジェクト構造

```
my-new-project/
├── src/
│   └── my_project/          # または TypeScript の場合は src/
│       ├── domain/          # ビジネスエンティティとルール
│       ├── usecase/         # アプリケーションビジネスロジック
│       ├── adapter/         # コントローラーとプレゼンター
│       └── infrastructure/  # データベースと外部API
├── tests/
│   ├── unit/               # ユニットテスト（80%+カバレッジ）
│   ├── integration/        # 統合テスト（60%+カバレッジ）
│   └── e2e/                # E2Eテスト
├── docs/                   # ドキュメント
├── .github/
│   └── workflows/          # CI/CDワークフロー（5種類）
├── pyproject.toml          # Python設定（または package.json）
├── pyrightconfig.json      # 型チェッカー設定（または tsconfig.json）
├── .pre-commit-config.yaml # Pre-commitフック（または .husky/）
├── .gitignore
├── README.md
├── SECURITY.md
└── CONTRIBUTING.md
```

### GitHub ラベル（53個）

- **優先度**: priority-critical, priority-high, priority-medium, priority-low
- **タイプ**: feature, enhancement, bug, hotfix
- **コンポーネント**: frontend, backend, database, infrastructure, ui-ux, api, security
- **ステータス**: needs-review, in-progress, blocked, approved
- **要件分類**: must-have, want-have
- **ストーリーポイント**: story-1, story-2, story-3, story-5, story-8, story-13, story-21
- **プロセス**: design, requirement, change-request
- **自動化**: automated, from-meeting
- **特殊**: escalation, technical-debt

### GitHub Wiki（9ページ）

1. Home - ナビゲーションハブ
2. Project-Overview - KPI、ステークホルダー、マイルストーン
3. Requirements - 機能要件・非機能要件
4. Team-Info - 連絡先、ミーティングスケジュール
5. Development-Guide - コーディング規約、Git ワークフロー
6. Architecture - Clean Architecture ドキュメント
7. API-Design - REST API 規約
8. Test-Plan - テスト戦略と手順
9. ADR-Template - Architecture Decision Record テンプレート

### CI/CD ワークフロー（5種類）

1. **lint-and-test.yml**: リント、型チェック、テスト実行
2. **security-scan.yml**: 依存関係の脆弱性スキャン、SAST
3. **deploy-dev.yml**: 開発環境へのデプロイ
4. **deploy-staging.yml**: ステージング環境へのデプロイ
5. **deploy-production.yml**: 本番環境へのデプロイ

### Issue テンプレート（5種類）

1. UI/UX デザインリクエスト
2. 機能要件
3. バグレポート
4. 変更リクエスト
5. セキュリティ問題

## 🔧 トラブルシューティング

### Git フックが実行されない

```bash
# Python
uv run pre-commit install

# TypeScript
pnpm exec husky install
```

### 依存関係がインストールできない

```bash
# Python
uv sync --reinstall

# TypeScript
pnpm install --force
```

### GitHub API レート制限エラー

しばらく時間をおいてから再実行してください。

### スクリプト実行権限エラー

```bash
chmod +x setup-new-project.sh
chmod +x setup/*.sh
```

## 📚 関連ドキュメント

- [SETUP_GUIDE.md](./SETUP_GUIDE.md) - 詳細なセットアップガイド
- [SETUP_INSTRUCTIONS.md](./SETUP_INSTRUCTIONS.md) - クイックセットアップ手順
- [github-projects-setup.md](./github-projects-setup.md) - GitHub Projects 設定ガイド
- [Engineering Handbook](https://github.com/sera-inc/engineering-handbook) - 開発ガイドライン全体

## 💡 ベストプラクティス

### プロジェクト開始時

1. ✅ この手順書に従って完全なセットアップを実行
2. ✅ README.md をプロジェクト固有の内容に更新
3. ✅ GitHub Projects でマイルストーンを設定
4. ✅ チームメンバーをリポジトリとプロジェクトに招待
5. ✅ 初回ミーティングでワークフローを共有

### 開発中

1. ✅ 常に feature ブランチで作業
2. ✅ コミット前にローカルで品質チェックを実行
3. ✅ PR は 400 行以内に抑える
4. ✅ Issue と PR を適切にリンク
5. ✅ プロジェクトボードのステータスを更新

## 🆘 ヘルプ

質問や問題がある場合：

1. この手順書と [SETUP_GUIDE.md](./SETUP_GUIDE.md) を確認
2. [Engineering Handbook](https://github.com/sera-inc/engineering-handbook) をレビュー
3. 既存の Issue を検索
4. チーム Slack で質問
5. Issue を作成

## 🎉 まとめ

この手順に従うことで、engineering-handbookの全ルールに準拠した、完全にセットアップされたプロジェクトを数分で開始できます。

**重要なポイント**:
- 🚀 GitHubテンプレートは使わず、初期化スクリプトを使用
- 📊 GitHub Projects、Wiki、Issue、PRが完全統合
- 🔄 CI/CD パイプラインが自動実行
- ✅ 品質ゲートが自動適用
- 📚 ドキュメントが構造化されて提供

Happy coding! 🎉
